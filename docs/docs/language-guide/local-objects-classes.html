<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ローカルオブジェクトとクラス :: Motoko documentation</title>
    <meta name="generator" content="Antora 2.3.4">
<link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /><meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:title" content="The Internet Computer | Documentation" />
<meta property="og:description" content="Documentation for the internet computer." />
<meta property="og:image" content="../../_/img/share.jpg" />
<meta property="og:image:url" content="../../_/img/share.jpg" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@DFINITYDev" />
<meta name="twitter:image" content="../../_/img/logo-RGB.png" />
<meta name="twitter:image:alt" content="DFINITY Logo" />    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="logo-container" href="https://dfinity.org/">
        <img class="header-logo" src="../../_/img/logo.svg">
        <h1 class="header-title">Motoko documentation</h1>
      </a>
    </div>
    <div class="nav-items-wrapper">
      <div class="search-container">
  <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd"
      d="M11.8654 12.5892C10.8213 13.4695 9.47259 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8C14 9.47209 13.4699 10.8204 12.5901 11.8643L17.3625 16.6367L16.6377 17.3615L11.8654 12.5892ZM12.9333 8C12.9333 10.7246 10.7246 12.9333 8 12.9333C5.2754 12.9333 3.06667 10.7246 3.06667 8C3.06667 5.2754 5.2754 3.06667 8 3.06667C10.7246 3.06667 12.9333 5.2754 12.9333 8Z"
      fill="black" />
  </svg>


  <input class="search-input" placeholder="Search" type="search" />
</div>      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div id="topbar-nav" class="navbar-menu">
        <div class="navbar-end">
          <a class="navbar-item" target="blank" href="https://forum.dfinity.org/">Forum</a>
          <a class="navbar-item" target="blank" href="mailto:support@dfinity.org?subject=Feedback - SDK Developer Center">Email us</a>
          <a class="navbar-item" target="blank" href="https://www.twitter.com/dfinitydev">
            <img src="../../_/img/social/twitter-icon.svg">
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="file:///build/doc/modules/language-guide/pages/local-objects-classes.adoc"><svg class="edit-icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/><path d="M0 0h24v24H0z" fill="none"/></svg></a></div>
</div>
<div class="main-content">
<article class="doc">
<h1 class="page">ローカルオブジェクトとクラス</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Motoko において <code>object</code> とは、ローカルのステート（<code>var</code> に束縛された変数）を、そのステートにアクセスしたり更新したりする <code>public</code> メソッドを組み込んでカプセル化したものです。</p>
</div>
<div class="paragraph">
<p>Motoko プログラムは、他の型付け言語と同様に、ステートをカプセル化して抽象的な型を持つオブジェクトを生成できることによる利便性を享受しています。</p>
</div>
<div class="paragraph">
<p>しかしながら、可変（Mutable）なステートを含む Motoko オブジェクトは <em>共有不可能（ Not shareable）</em> となっています。これはセキュリティを指向するための重要な設計上の決定です。</p>
</div>
<div class="paragraph">
<p>もしもミュータブルなステートを含むオブジェクトが共有可能（Shareable）だとすると、概念的にはオブジェクトのコードを Actor 間で移動させてリモートで実行することや、リモートのロジックにステートを共有することになり、セキュリティ上のリスクとなります。（ただし、オブジェクトが純粋な record 型である場合には、ミュータブルなステートではなくなるため、共有可能です。）</p>
</div>
<div class="paragraph">
<p>このセキュリティ上必要な制限を補うために、<code>Actor</code> オブジェクトは <em>共有可能</em> ですが、常にリモートで実行されます。
これは共有可能な Motoko データとのみ通信します。
ローカルのオブジェクトは、自分自身とはそれほど制限されずに対話し、他のオブジェクトも含めた任意の Motoko データをお互いのメソッドに渡すことができます。
共有不可能な点を除くと、その他のほとんどの点でローカルオブジェクト (およびクラス) は Actor オブジェクト (およびクラス) とよく似ています。</p>
</div>
<div class="paragraph">
<p><a href="mutable-state.html">ミュータブルなステート</a>では、<code>var</code> に束縛された変数や（ミュータブルな）配列の割り当てといった形で、プライベートなミュータブルステートの宣言の仕方について紹介しています。
この章では、オブジェクト指向プログラミングで簡単なオブジェクトを実装するのと同じように、ミュータブルなステートを使って簡単なオブジェクトを実装します。</p>
</div>
<div class="paragraph">
<p>この言語サポートを実行例を使って説明し、次の章へと続きます。
以下の例は、Motoko プログラムの進化の道程を表しています。
各 <em>オブジェクト</em> は、その重要性が高いのであれば、<em>（ローカル） オブジェクト</em> を <em>Actor オブジェクト</em> にリファクタリングすることで、Internet Computer の <em>Service</em> へとリファクタリングできる可能性があります。</p>
</div>
<div class="paragraph">
<p><strong>オブジェクトクラス</strong>。あるタスクを実行するために、関連するオブジェクト <em>群</em> が必要になることがよくあります。
オブジェクトが似たような動作をする場合、初期のステートはカスタマイズ可能にしつつ、同じ設計図に基づいてオブジェクトを作成することは理にかなっています。
この目的のため、Motoko は <code>class</code> 定義と呼ばれる構文構造を提供しており、同じ型で同じ実装のオブジェクトを簡単に作ることができます。
オブジェクトについて説明した後に、これらを紹介します。</p>
</div>
<div class="paragraph">
<p><strong>Actor クラス</strong>。
オブジェクトクラスが <em><a href="actors-async.adoc">Service</a></em>（非同期動作）を公開している場合、対応する Motoko の構造は <a href="actors-async.adoc">Actor クラス</a>であり、よく似た（ただし異なる）設計に従います。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_例カウンタオブジェクト"><a class="anchor" href="#_例カウンタオブジェクト"></a>例：カウンタオブジェクト</h2>
<div class="sectionbody">
<div class="paragraph">
<p>次のように、オブジェクト値である <code>counter</code> の <em>オブジェクト宣言</em> を考えてみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">object counter {
  var count = 0;
  public func inc() { count += 1 };
  public func read() : Nat { count };
  public func bump() : Nat {
    inc();
    read()
  };
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>この宣言により、<code>counter</code> という名前のオブジェクトのインスタンスが導入され、その全体の実装は上のようになります。</p>
</div>
<div class="paragraph">
<p>この例では、開発者は3つの <em>public</em> 関数である <code>inc</code>、<code>read</code>、<code>bump</code> を、
キーワード <code>public</code> を使用してオブジェクトの本体で宣言しています。
オブジェクトの本体は、ブロック式のように宣言のリストで構成されています。</p>
</div>
<div class="paragraph">
<p>これらの3つの関数に加えて、オブジェクトは1つの（プライベートな）ミュータブル変数 <code>count</code> を持ち、現在のカウントの値（初期値は 0）を保持します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_オブジェクト型"><a class="anchor" href="#_オブジェクト型"></a>オブジェクト型</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この <code>counter</code> オブジェクトは、次のような <em>オブジェクト型</em> を持ち、これはフィールド型のペアを中括弧（<code>{</code> と <code>}</code>）で囲んだリストとして書かれます。</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">{
  inc  : () -&gt; () ;
  read : () -&gt; Nat ;
  bump : () -&gt; Nat ;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>各フィールドの型は、識別子、コロン <code>:</code>、フィールドの内容を表す型によって構成されています。ここでは、各フィールドは関数なので、<em>アロー</em> 型の形式（<code>_ &#8594; _</code>）になっています。</p>
</div>
<div class="paragraph">
<p><code>object</code> の宣言では、変数 <code>count</code> が <code>public</code> と <code>private</code> のどちらにも明示的に宣言されていません。</p>
</div>
<div class="paragraph">
<p>デフォルトでは、オブジェクトブロック内のすべての宣言は <code>private</code> となり、ここでの <code>count</code> も同様です。
結果的に、<code>count</code> の型はオブジェクトの型には現れず、その名前も存在も外部からはアクセスできません。</p>
</div>
<div class="paragraph">
<p>フィールドにアクセスできないということには強力なメリットがあります。
実装の詳細を公開しないことで、オブジェクトは <em>より一般的な</em> 型（より少ないフィールド）を持ちます。その結果、couter オブジェクトと同じ型で実装が異なるオブジェクトと、フィールドを使用せずに交換することができます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_例_bytecounter_オブジェクト"><a class="anchor" href="#_例_bytecounter_オブジェクト"></a>例: <code>byteCounter</code> オブジェクト</h2>
<div class="sectionbody">
<div class="paragraph">
<p>上記の点を説明するために、<code>counter</code> 宣言のバリエーションである <code>byteCounter</code> を考えてみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">import Nat8 "mo:base/Nat8";
object byteCounter {
  var count : Nat8 = 0;
  public func inc() { count += 1 };
  public func read() : Nat { Nat8.toNat(count) };
  public func bump() : Nat { inc(); read() };
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>このオブジェクトは <code>counter</code> と同じ型を持っているので、型チェックの観点からは <code>counter</code> と交換可能です。</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">{
  inc  : () -&gt; () ;
  read : () -&gt; Nat ;
  bump : () -&gt; Nat ;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>しかし、はじめに示した <code>counter</code> とはフィールドの実装は同じではありません。
このバージョンでは、オーバーフローしない通常の自然数 <code>Nat</code> を使用するのではなく、サイズが常に 8 ビットである自然数 (<code>Nat8</code> 型) を使用します。</p>
</div>
<div class="paragraph">
<p>このようにすることで、<code>inc</code> オペレーションがオーバーフローを起こして失敗する可能性があります。以前のバージョンでは決してオーバーフローすることはありませんでしたが、その代わりにプログラムのメモリを埋め尽くしてしまうという、別のアプリケーションエラーを引き起こす可能性があります。</p>
</div>
<div class="paragraph">
<p>いずれの実装にもある程度の複雑さがありますが、どちらも同じ型となっています。</p>
</div>
<div class="paragraph">
<p>一般的に、（オブジェクトや Service の）2つの実装間で同じ型となるようにすると、内部の実装の複雑さを隠蔽し、それを使用するアプリケーションの残りの部分から取り除きます。
ここでは、2つのオブジェクトに共通の型（<code>Nat</code>）は、数値の表現方法に関する選択を抽象化しています。
上の例は単純なものでしたが、一般的には実装の選択はより複雑で、より興味深いものになるでしょう。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_オブジェクトのサブタイピング"><a class="anchor" href="#_オブジェクトのサブタイピング"></a>オブジェクトのサブタイピング</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Motoko におけるオブジェクトのサブタイピングの役割と使い方を説明するために、より一般的な（パブリックな操作が少ない）型で、よりシンプルなカウンタを実装してみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">object bumpCounter {
  var c = 0;
  public func bump() : Nat {
    c += 1;
    c
  };
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>オブジェクト <code>bumpCounter</code> は次のようなオブジェクト型を持ち、ただ1つの操作である <code>bump</code> を公開しています。</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">{
  bump : () -&gt; Nat ;
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>この型は最も一般的な操作を公開し、特定の動作のみを許可します。
例えば、カウンタの値は増加させることしかできず、減少させたり、任意の値に設定することはできません。</p>
</div>
<div class="paragraph">
<p>システムの他の部分では、より多くの操作を備えた <em>より一般的でない</em> バージョンを実装して使用することができます。</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">fullCounter : {
  inc   : () -&gt; () ;
  read  : () -&gt; Nat ;
  bump  : () -&gt; Nat ;
  write : Nat -&gt; () ;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここでは、はじめに示したものよりも一般性が低い <code>fullCounter</code> というカウンタを考えます。
このカウンタには <code>inc</code>、<code>read</code>、<code>bump</code> に加えて <code>write</code> が含まれており、呼び出し側は、現在のカウント値を <code>0</code> に戻すなど、任意の値に変更することができます。</p>
</div>
<div class="paragraph">
<p><strong>オブジェクトのサブタイピング</strong>：Motoko では、オブジェクトにはサブタイピングによって関係付けられる型があります。標準的には、<em>よりフィールドの多い型</em> は、<em>より一般的でない型</em> となります（<em><strong>サブ</strong>タイプ</em>）。例えば、上の例で示した型は、次のような関係があるとまとめることができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>最も一般的な型は以下です。</p>
</li>
</ul>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">{ bump : () -&gt; Nat }</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>中間の一般性を持つ型は以下です。</p>
</li>
</ul>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">{
  inc  : () -&gt; () ;
  read : () -&gt; Nat ;
  bump : () -&gt; Nat ;
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>最も一般的でない型は以下です。</p>
</li>
</ul>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">{
  inc  : () -&gt; () ;
  read : () -&gt; Nat ;
  bump : () -&gt; Nat ;
  write : Nat -&gt; () ;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>関数が最初の型（<code>{ bump: () &#8594; Nat }</code>) のオブジェクトを受け取ることを期待している場合、上記の型の <em>いずれも</em> 、この（最も一般的な）型と等しいかそのサブタイプであるため、何の問題もありません。</p>
</div>
<div class="paragraph">
<p>しかし、最も一般的でない最後の型のオブジェクトを受け取ることを期待している場合、他の2つの型は十分ではありません。なぜなら、ある関数が当然アクセスできると期待している <code>write</code> 操作を、他の2つの型はどちらも持っていないためです。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_オブジェクトクラス"><a class="anchor" href="#_オブジェクトクラス"></a>オブジェクトクラス</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Motoko では、オブジェクトはステートをカプセル化したものであり、オブジェクトの <code>class</code> は、共通の名前を持つ2つのエンティティのパッケージです。</p>
</div>
<div class="paragraph">
<p>ゼロから始まるカウンタの <code>class</code> を例に考えてみましょう。</p>
</div>
<div id="counter" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">class Counter() {
  var c = 0;
  public func inc() : Nat {
    c += 1;
    return c;
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>この定義の価値は、新しいカウンタとしてインスタンスを生成（<em>construct</em>）できることです。
生成したカウンタは、それぞれが独自のステートで始まり、初期値はゼロになります。</p>
</div>
<div id="cinit" class="listingblock include_counter">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">let c1 = Counter();
let c2 = Counter();</code></pre>
</div>
</div>
<div class="paragraph">
<p>これらはそれぞれ独立しています。</p>
</div>
<div class="listingblock include_counter_cinit">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">let x = c1.inc();
let y = c2.inc();
(x, y)</code></pre>
</div>
</div>
<div class="paragraph">
<p>オブジェクトを返す関数を書くことでも同じ結果を得ることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">func Counter() : { inc : () -&gt; Nat } =
  object {
    var c = 0;
    public func inc() : Nat { c += 1; c }
  };</code></pre>
</div>
</div>
<div class="paragraph">
<p>この <em>コンストラクタ関数</em> の戻り値の型（オブジェクト型）に注目してください。</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">{ inc : () -&gt; Nat }</code></pre>
</div>
</div>
<div class="paragraph">
<p>この型を例えば <code>Counter</code> と名付け、次のように型宣言に使用することができます。</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">type Counter = { inc : () -&gt; Nat };</code></pre>
</div>
</div>
<div class="paragraph">
<p>実際、上に示した <code>class</code> キーワードの構文は、<code>Counter</code> に対するこれら 2 つの定義の略記に他なりません。2つの定義とは、オブジェクトを構築するファクトリ関数 <code>Counter</code> と、これらのオブジェクトの型 <code>Counter</code> のことです。クラスはこの利便性以上の新しい機能を提供するものではありません。</p>
</div>
<div class="sect2">
<h3 id="_クラスコンストラクタ"><a class="anchor" href="#_クラスコンストラクタ"></a>クラスコンストラクタ</h3>
<div class="paragraph">
<p>オブジェクトクラスは、0 個以上のデータ引数と、0 個以上の型引数を持つことができるコンストラクタ関数を定義しています。</p>
</div>
<div class="paragraph">
<p>上の <code>Counter</code> の例では、それぞれ 0 個です。</p>
</div>
<div class="paragraph">
<p>型引数がある場合は、そのクラスの型とコンストラクタ関数の両方をパラメータ化します。</p>
</div>
<div class="paragraph">
<p>データ引数がある場合は、クラスのコンストラクタ関数（のみ）をパラメータ化します。</p>
</div>
<div class="sect3">
<h4 id="_データ引数"><a class="anchor" href="#_データ引数"></a>データ引数</h4>
<div class="paragraph">
<p>カウンターを 0 以外の値で初期化したいとします。その値を <code>class</code> コンストラクタのデータ引数として与えることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">class Counter(init : Nat) {
  var c = init;
  public func inc() : Nat { c += 1; c };
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>このパラメータはすべてのメソッドで利用可能です。</p>
</div>
<div class="paragraph">
<p>例えば、初期値のパラメータに対して <code>Counter</code> を <code>reset</code> することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">class Counter(init : Nat) {
  var c = init;
  public func inc() : Nat { c += 1; c };
  public func reset() { c := init };
};</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_型引数"><a class="anchor" href="#_型引数"></a>型引数</h4>
<div class="paragraph">
<p>カウントするためのデータを特殊な <code>Buffer</code> のようにしてカウンタに持たせたいとします。</p>
</div>
<div class="paragraph">
<p>クラスが任意の型のデータを使用したり含む場合、型関数と同様に、未知の型のための引数（<em>型引数</em>）を持ちます。</p>
</div>
<div class="paragraph">
<p>この型引数のスコープは、データ引数と同じように <code>class</code> 全体をカバーします。
そのため、クラスのメソッドはこれらの型引数を使用することができます（<em>再び導入</em> する必要はありません）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">import Buffer "mo:base/Buffer";

class Counter&lt;X&gt;(init : Buffer.Buffer&lt;X&gt;) {
  var buffer = init.clone();
  public func add(x : X) : Nat {
    buffer.add(x);
    buffer.size()
  };

  public func reset() {
    buffer := init.clone()
  };
};</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_型注釈"><a class="anchor" href="#_型注釈"></a>型注釈</h4>
<div class="paragraph">
<p>オプションで、クラスのコンストラクタに "戻り値の型" （生成するオブジェクトの型）の型注釈を付けることもできます。
型注釈が付与されると、Motoko はこの型注釈がクラスの本体（オブジェクト定義）と互換性があるかどうかをチェックします。
このチェックにより、コンストラクタが生成する各オブジェクトが提供された仕様に適合することが保証されます。</p>
</div>
<div class="paragraph">
<p>例えば、先述の <code>Counter</code> に対して、より一般的な型である <code>Accum&lt;X&gt;</code> で型注釈します。<code>Accum&lt;X&gt;</code> は値を増やすことはできますが、リセットすることはできないものとします。
この注釈により、オブジェクトは <code>Accum&lt;X&gt;</code> 型と互換性があることが保証されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">import Buffer "mo:base/Buffer";

type Accum&lt;X&gt; = { add : X -&gt; Nat };

class Counter&lt;X&gt;(init : Buffer.Buffer&lt;X&gt;) : Accum&lt;X&gt; {
  var buffer = init.clone();
  public func add(x : X) : Nat { buffer.add(x); buffer.size() };
  public func reset() { buffer := init.clone() };
};</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_全ての構文"><a class="anchor" href="#_全ての構文"></a>全ての構文</h4>
<div class="paragraph">
<p>クラスは、キーワード <code>class</code> に続けて以下を与えることで定義します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>定義されるコンストラクタと型の名前（たとえば <code>Counter</code>）</p>
</li>
<li>
<p>オプションの型引数（省略するか、<code>&lt;X&gt;</code>、<code>&lt;X, Y&gt;</code> など）</p>
</li>
<li>
<p>引数リスト（<code>()</code> または <code>(init : Nat)</code> など）</p>
</li>
<li>
<p>コンストラクタに生成されたオブジェクトに対するオプションの型注釈（省略するか、例えば <code>Accum&lt;X&gt;</code> など）</p>
</li>
<li>
<p>クラスの "本体" はオブジェクトの定義であり、（もしあれば）型と値の引数によってパラメータ化されます。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>public</code> とマークされたクラス本体の構成要素は、生成されるオブジェクトの型に寄与し、これらの型は（オプションの）型注釈と比較されます。</p>
</div>
<div class="sect4">
<h5 id="_他の例_bits"><a class="anchor" href="#_他の例_bits"></a>他の例: <code>Bits</code></h5>
<div class="paragraph">
<p>他の例として、<code>Nat</code> 型の自然数のビット移動のタスクを考えてみましょう。例えば、以下のように定義することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">class Bits(n : Nat) {
  var state = n;
  public func next() : ?Bool {
    if (state == 0) { return null };
    let prev = state;
    state /= 2;
    ?(state * 2 != prev)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記のクラス定義は、構造的な型シノニムとファクトリ関数をどちらも <code>Bits</code> という名前で同時に定義することと同義です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">type Bits = {next : () -&gt; ?Bool}
let Bits : Nat -&gt; Bits =
func Bits(n : Nat) : Bits = object {
  // クラス本体
};</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_構造的サブタイピング"><a class="anchor" href="#_構造的サブタイピング"></a>構造的サブタイピング</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Motoko におけるオブジェクトのサブタイピングは <em>構造的サブタイピング</em> を使用しており、<em>公称型サブタイピング</em> ではありません。</p>
</div>
<div class="paragraph">
<p>公称型サブタイピングでは、2 つの型が等価かどうかは（プロジェクトや時間を超えて）一貫した、グローバルにユニークな型名の選択に依存することを思い出してください。</p>
</div>
<div class="paragraph">
<p>Motoko では、2 つの型の等価性の問題は、名前ではなく <em>構造</em> に基づきます。</p>
</div>
<div class="paragraph">
<p>構造的サブタイピングによって、クラスの型に名前を付けることによって便利な省略形として使うことができます。</p>
</div>
<div class="paragraph">
<p>しかし、型付けの目的において重要なのは、対応するオブジェクト型の <em>構造</em> です。名前が違っても、同等の定義を持つ 2 つのクラスは型互換性のあるオブジェクトを生成します。</p>
</div>
<div class="paragraph">
<p>クラス宣言の中で型注釈が指定された場合、その適合性がチェックされます。オブジェクトの型は型注釈のサブタイプでなければなりません。ただし、型注釈がオブジェクト型の適切なスーパータイプを記述しているだけであっても、型注釈はそのクラスの型に影響しません。</p>
</div>
<div class="paragraph">
<p>形式的には、Motoko のサブタイプの関係は、オブジェクト型だけでなく、すべての型に拡張されます。</p>
</div>
<div class="paragraph">
<p>ほとんどの場合は標準的なものであり、従来のプログラミング言語理論（特に <em>構造的サブタイピング</em>）に従っています。</p>
</div>
<div class="paragraph">
<p>新しいプログラマにとって、Motoko の他の注目すべき事柄は配列、オプション、バリアント、数値型の相互関係です。</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar">
  
  <div class="toc-menu"></div>
</aside></div>
</main></div>
<footer class="footer">
  <div class="footer-container">
    <a href="http://www.dfinity.org"><img class="footer-logo" src="../../_/img/logo.svg"></a>
    <nav class="footer-nav">
      <div class="col1">
        <h5 class="footer-header">Developers</h5>
        <a class="footer-link" href="http://www.dfinity.org/faq">
          FAQ
        </a>
        <a class="footer-link" href="#">
          Developers
        </a>
        <a class="footer-link" href="http://www.dfinity.org/data-centers">
          Data Centers
        </a>
      </div>

      <div class="col2">
        <h5 class="footer-header">Team</h5>
        <a class="footer-link" href="http://www.dfinity.org/foundation">
          Foundation
        </a>
        <a class="footer-link" href="http://www.dfinity.org/foundation#events">
          Events
        </a>
        <a class="footer-link" href="http://www.dfinity.org/careers">
          Careers
        </a>
      </div>


      <div class="col3">
        <h5 class="footer-header">Media</h5>
        <a class="footer-link" href="http://www.dfinity.org/media">
          Featured Videos
        </a>
        <a class="footer-link" href="http://www.dfinity.org/media#featured-stories">
          Featured Stories
        </a>
        <a class="footer-link" href="http://www.dfinity.org/newsletter">
          Newsletter
        </a>
      </div>

      <div class="social-icons">

        <a class="social-icon-link" target="blank" href="https://github.com/dfinity">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M12 0C5.3625 0 0 5.3625 0 12C0 17.2875 3.45 21.7875 8.2125 23.4C8.8125 23.5125 9.0375 23.1375 9.0375 22.8375C9.0375 22.5375 9.0375 21.7875 9.0375 20.8125C5.7 21.525 4.9875 19.2 4.9875 19.2C4.425 17.8125 3.6375 17.4375 3.6375 17.4375C2.55 16.6875 3.7125 16.725 3.7125 16.725C4.9125 16.8 5.55 17.9625 5.55 17.9625C6.6375 19.8 8.3625 19.275 9.0375 18.975C9.15 18.1875 9.45 17.6625 9.7875 17.3625C7.125 17.0625 4.3125 16.0125 4.3125 11.4375C4.3125 10.125 4.7625 9.075 5.55 8.2125C5.4375 7.9125 5.025 6.675 5.6625 5.025C5.6625 5.025 6.675 4.6875 8.9625 6.2625C9.9375 6 10.95 5.85 11.9625 5.85C12.975 5.85 14.025 6 14.9625 6.2625C17.25 4.725 18.2625 5.025 18.2625 5.025C18.9 6.675 18.4875 7.9125 18.375 8.2125C19.1625 9.0375 19.6125 10.125 19.6125 11.4375C19.6125 16.05 16.8 17.0625 14.1375 17.3625C14.55 17.7375 14.9625 18.45 14.9625 19.575C14.9625 21.1875 14.9625 22.4625 14.9625 22.875C14.9625 23.2125 15.1875 23.5875 15.7875 23.4375C20.55 21.7875 24 17.2875 24 12C24 5.3625 18.6375 0 12 0Z"
              fill="#333333" />
          </svg>

        </a>
        <a class="social-icon-link" target="blank" href="https://medium.com/dfinity-network-blog">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M22.3125 1H1.6875C1.50516 1 1.3303 1.07243 1.20136 1.20136C1.07243 1.3303 1 1.50516 1 1.6875L1 22.3125C1 22.4948 1.07243 22.6697 1.20136 22.7986C1.3303 22.9276 1.50516 23 1.6875 23H22.3125C22.4948 23 22.6697 22.9276 22.7986 22.7986C22.9276 22.6697 23 22.4948 23 22.3125V1.6875C23 1.50516 22.9276 1.3303 22.7986 1.20136C22.6697 1.07243 22.4948 1 22.3125 1V1ZM19.2768 6.21228L18.0971 7.34356C18.0471 7.38153 18.0085 7.43245 17.9854 7.4908C17.9623 7.54916 17.9557 7.61272 17.9661 7.67459V15.9875C17.9557 16.0494 17.9623 16.1129 17.9854 16.1713C18.0085 16.2296 18.0471 16.2806 18.0971 16.3185L19.2493 17.4498V17.698H13.4534V17.4498L14.6469 16.2903C14.7641 16.1731 14.7641 16.1388 14.7641 15.9593V9.24072L11.4455 17.6698H10.9987L7.13319 9.24072V14.8899C7.11729 15.0071 7.12828 15.1264 7.16533 15.2387C7.20237 15.351 7.2645 15.4535 7.347 15.5382L8.89937 17.4213V17.6695H4.49731V17.4213L6.04969 15.5382C6.13152 15.4534 6.19226 15.3505 6.22701 15.2379C6.26177 15.1253 6.26956 15.0061 6.24975 14.8899V8.35866C6.25855 8.26945 6.24627 8.17943 6.21391 8.09584C6.18155 8.01225 6.13001 7.93743 6.06344 7.87741L4.68362 6.21503V5.96684H8.96847L12.2805 13.2303L15.1924 5.96684H19.2768V6.21228Z"
              fill="#333333" />
          </svg>

        </a>
        <a class="social-icon-link" target="blank" href="https://twitter.com/dfinity">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M23 5.33654C22.175 5.67308 21.3156 5.94231 20.4219 6.04327C21.35 5.50481 22.0719 4.62981 22.4156 3.58654C21.5562 4.09135 20.5938 4.46154 19.5625 4.66346C18.7031 3.78846 17.5344 3.25 16.2281 3.25C13.7187 3.25 11.725 5.23558 11.725 7.65865C11.725 7.99519 11.7594 8.33173 11.8281 8.66827C8.08125 8.5 4.74688 6.71635 2.54688 4.05769C2.16875 4.69712 1.92813 5.47115 1.92813 6.27885C1.92813 7.82692 2.71875 9.17308 3.92188 9.94712C3.16562 9.91346 2.47812 9.71154 1.89375 9.40865C1.89375 9.44231 1.89375 9.44231 1.89375 9.47596C1.89375 11.6298 3.44063 13.4135 5.50313 13.8173C5.125 13.9183 4.7125 13.9856 4.3 13.9856C4.025 13.9856 3.71562 13.9519 3.44062 13.9183C4.025 15.6683 5.675 16.9471 7.66875 16.9808C6.12187 18.1587 4.1625 18.8654 2.06562 18.8654C1.6875 18.8654 1.34375 18.8317 1 18.7981C2.99375 20.0096 5.36563 20.75 7.90938 20.75C16.2281 20.75 20.7656 14.0192 20.7656 8.16346C20.7656 7.96154 20.7656 7.79327 20.7656 7.59135C21.625 6.98558 22.3813 6.21154 23 5.33654Z"
              fill="#333333" />
          </svg>

        </a>

        <a class="social-icon-link" target="blank" href="https://forum.dfinity.org/">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12.0932 1C6.0727 1 1 5.83706 1 11.8085C1 12 1.00488 23 1.00488 23L12.0933 22.9901C18.1188 22.9901 23 17.9666 23 11.9951C23 6.02373 18.1188 1 12.0932 1ZM12 18.2857C11.0473 18.2857 10.1388 18.0745 9.32853 17.6916L5.34597 18.6786L6.47047 14.9956C5.98926 14.1067 5.71423 13.0853 5.71423 12C5.71423 8.52815 8.52811 5.71428 12 5.71428C15.4719 5.71428 18.2857 8.52815 18.2857 12C18.2857 15.472 15.4719 18.2857 12 18.2857Z"
              fill="#333333" />
          </svg>

        </a>

        <a class="social-icon-link" target="blank" href="https://www.linkedin.com/company/dfinity'">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M1 4.35878C1 3.01688 2.03589 2 3.61924 2C5.20139 2 6.17406 3.01448 6.20507 4.35519C6.20507 5.67205 5.20139 6.71456 3.58942 6.71456H3.55841C2.00666 6.71456 1 5.67562 1 4.35878ZM17.5581 8.28158C15.1017 8.28158 13.5625 9.61217 13.278 10.5449V8.41225H8.46122C8.52324 9.54475 8.46122 21.9995 8.46122 21.9995H13.278V14.647C13.278 14.5987 13.2778 14.5505 13.2775 14.5025C13.2756 14.1436 13.2736 13.7952 13.383 13.5365C13.714 12.7194 14.4255 11.8719 15.7046 11.8719C17.3775 11.8719 18.1378 13.128 18.1378 14.9685V21.9995H23V14.4448C23 10.236 20.6056 8.28158 17.5581 8.28158ZM1.55371 8.41275H5.84157V22H1.55371V8.41275Z"
              fill="#333333" />
          </svg>

        </a>

        <a class="social-icon-link" target="blank" href="https://youtube.com/dfinity">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M23.775 7.6375C23.775 7.6375 23.55 5.9875 22.8375 5.2375C21.9375 4.3 20.8875 4.2625 20.4375 4.225C17.025 4 12 4 12 4C12 4 6.975 4 3.6 4.225C3.1125 4.2625 2.1 4.3 1.2 5.2375C0.4875 5.95 0.2625 7.6375 0.2625 7.6375C0.2625 7.6375 0 9.5875 0 11.5375V13.375C0 15.325 0.225 17.275 0.225 17.275C0.225 17.275 0.45 18.925 1.1625 19.675C2.0625 20.6125 3.2625 20.6125 3.825 20.6875C5.7375 20.875 12 20.9125 12 20.9125C12 20.9125 17.025 20.9125 20.4 20.65C20.8875 20.6125 21.9 20.575 22.8 19.6375C23.5125 18.925 23.7375 17.2375 23.7375 17.2375C23.7375 17.2375 24 15.2875 24 13.3375V11.5C24 9.5875 23.775 7.6375 23.775 7.6375ZM9.525 15.55V8.8L16.0125 12.175L9.525 15.55Z"
              fill="#333333" />
          </svg>

        </a>

      </div>
    </nav>

    <div class="legal-container">
      <span class="legal" id="year">
        © 2020 DFINITY
      </span>
      <a class="legal footer-link" href="http://www.dfinity.org/terms-of-use">
        Terms of Use
      </a>
      <a class="legal footer-link" href="http://www.dfinity.org/cookie-policy">
        Cookie Policy
      </a>
      <a class="legal footer-link" href="http://www.dfinity.org/privacy-policy">
        Privacy Policy
      </a>
    </div>

  </div>
</footer>


<script>
  var today = new Date();
  var year = today.getFullYear();
  document.getElementById("year").innerHTML = `© ${year} DFINITY`;
</script><script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
    apiKey: 'b93d56cc4b00b0afbcdaacab04dcf25b',
    indexName: 'dfinity_sdk',
    inputSelector: '.search-input',
    debug: false // Set debug to true if you want to inspect the dropdown
  });
</script>

<!-- Start of dfinity Zendesk Widget script -->
<script id="ze-snippet" src="https://static.zdassets.com/ekr/snippet.js?key=53121947-c10a-484c-b99b-f89a9fb6f63e"> </script>
<!-- End of dfinity Zendesk Widget script -->

<script src="../../_/js/vendor/run_repl.js"></script>
<script type="module">
  import {CodeJar} from 'https://cdn.jsdelivr.net/npm/codejar@3.2.3/codejar.min.js';
  import {withLineNumbers} from 'https://cdn.jsdelivr.net/npm/codejar@3.2.3/linenumbers.js';
  window.CodeJar = CodeJar;
  window.withLineNumbers = withLineNumbers;
</script> 
<script type="text/javascript">
async function addPackage(name, repo, version, dir) {
  const meta_url = `../../_/js/vendor/${repo}/flat`;
  const base_url = `../../_/js/vendor/${repo}`;
  const response = await fetch(meta_url);
  const json = await response.json()
  const promises = [];
  const fetchedFiles = [];
  for (const f of json.files) {
    if (f.name.startsWith(`/${dir}/`) && /\.mo$/.test(f.name)) {
      const promise = (async () => {
        const content = await (await fetch(base_url + f.name)).text();
        const stripped = name + f.name.slice(dir.length + 1);
        fetchedFiles.push(stripped);
        Motoko.saveFile(stripped, content);
      })();
      promises.push(promise);
    }
  }
  Promise.all(promises).then(() => {
    Motoko.addPackage(name, name + '/');
    console.log("base library loaded");
    changeCodeBlock(); // from run_repl.js
  });
}
function loadBase() {
  addPackage('base', 'dfinity/motoko-base', 'moc-0.6.27', 'src');
}
</script>
<script async src="../../_/js/vendor/moc.js" onload="loadBase()">
</script>
  </body>
</html>
