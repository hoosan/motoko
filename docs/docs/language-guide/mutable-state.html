<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ミュータブルなステート :: Motoko documentation</title>
    <meta name="generator" content="Antora 2.3.4">
<link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /><meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:title" content="The Internet Computer | Documentation" />
<meta property="og:description" content="Documentation for the internet computer." />
<meta property="og:image" content="../../_/img/share.jpg" />
<meta property="og:image:url" content="../../_/img/share.jpg" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@DFINITYDev" />
<meta name="twitter:image" content="../../_/img/logo-RGB.png" />
<meta name="twitter:image:alt" content="DFINITY Logo" />    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="logo-container" href="https://dfinity.org/">
        <img class="header-logo" src="../../_/img/logo.svg">
        <h1 class="header-title">Motoko documentation</h1>
      </a>
    </div>
    <div class="nav-items-wrapper">
      <div class="search-container">
  <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd"
      d="M11.8654 12.5892C10.8213 13.4695 9.47259 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8C14 9.47209 13.4699 10.8204 12.5901 11.8643L17.3625 16.6367L16.6377 17.3615L11.8654 12.5892ZM12.9333 8C12.9333 10.7246 10.7246 12.9333 8 12.9333C5.2754 12.9333 3.06667 10.7246 3.06667 8C3.06667 5.2754 5.2754 3.06667 8 3.06667C10.7246 3.06667 12.9333 5.2754 12.9333 8Z"
      fill="black" />
  </svg>


  <input class="search-input" placeholder="Search" type="search" />
</div>      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div id="topbar-nav" class="navbar-menu">
        <div class="navbar-end">
          <a class="navbar-item" target="blank" href="https://forum.dfinity.org/">Forum</a>
          <a class="navbar-item" target="blank" href="mailto:support@dfinity.org?subject=Feedback - SDK Developer Center">Email us</a>
          <a class="navbar-item" target="blank" href="https://www.twitter.com/dfinitydev">
            <img src="../../_/img/social/twitter-icon.svg">
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="file:///build/doc/modules/language-guide/pages/mutable-state.adoc"><svg class="edit-icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/><path d="M0 0h24v24H0z" fill="none"/></svg></a></div>
</div>
<div class="main-content">
<article class="doc">
<h1 class="page">ミュータブルなステート</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Motoko の各 Actor は、内部のミュータブル（可変）なステートを使用することはできますが、<em>決して直接共有することはできません</em> 。</p>
</div>
<div class="paragraph">
<p>後ほど、<a href="sharing.html">Actor 間の共有</a>について議論しますが、
これは Actor が <em>イミュータブル</em> （不変）な データやハンドルを、shared 関数として提供されている外部エントリーポイントに送受信するものです。
これらの共有可能なデータを送受信する場合とは異なり、Motoko の設計上の重要な不変性は、<em><strong>ミュータブルなデータ</strong>は、それを割り当てた Actor の内部（プライベート）に保持され、<strong>リモートで共有されることは決してない</strong>ということです</em> 。</p>
</div>
<div class="paragraph">
<p>この章では、（プライベートな）Actor のステートを用いて、値の変更操作を行って時間の経過とともにステートの値を変化させる方法を、最小限の例を使って説明します。</p>
</div>
<div class="paragraph">
<p><a href="local-objects-classes.html">ローカルオブジェクトとクラス</a>では、ローカルオブジェクトの構文と、1つのミュータブルな変数を持つ最小構成の <code>counter</code> Actor を紹介しています。
<a href="actors-async.html">次の章</a>では、同じ動作をする Actor を用いますが、リモートで使用するための Service インターフェースによって間接的に counter 変数を公開する方法について説明しています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_イミュータブルな変数_vs_ミュータブルな変数"><a class="anchor" href="#_イミュータブルな変数_vs_ミュータブルな変数"></a>イミュータブルな変数 vs ミュータブルな変数</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>var</code> 構文は、宣言ブロックの中でミュータブルな変数を宣言します：</p>
</div>
<div id="init" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">let text  : Text = "abc";
let num  : Nat = 30;

var pair : (Text, Nat) = (text, num);
var text2 : Text = text;</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記の宣言リストでは、4つの変数を宣言しています。
最初の2つの変数 (<code>text</code> と <code>num</code>) は字句スコープされた <em>イミュータブルな変数</em> です。
最後の2つの変数 (<code>pair</code> と <code>text2</code>) は字句スコープされた <strong><em>ミュータブルな</em></strong> 変数です。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="intro-assignment"><a class="anchor" href="#intro-assignment"></a>ミュータブルなメモリへの割り当て</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ミュータブルな変数には代入が可能ですが、イミュータブルな変数には代入ができません。</p>
</div>
<div class="paragraph">
<p>上記の <code>text</code> や <code>num</code> に新しい値を代入しようとすると、これらの変数はイミュータブルなので静的型エラーが発生します。</p>
</div>
<div class="paragraph">
<p>しかし、ミュータブルな変数である <code>pair</code> と <code>text2</code> の値は、以下のように <code>:=</code> で表される代入の構文を使って自由に更新することができます：</p>
</div>
<div class="listingblock include_init">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">text2 := text2 # "xyz";
pair := (text2, pair.1);
pair</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記では、各変数の値に単純な <code>更新ルール</code> を適用することで各変数を更新しています（例えば、<code>text2</code> の接尾辞に文字列 <code>"xyz"</code> を付加することで  <em>更新</em> しています）。 同様に、Actor は内部（プライベート）のミュータブルな変数に対して同じ代入構文を使用して <em>update</em> を実行することで、更新の呼び出しを処理します。</p>
</div>
<div class="sect2">
<h3 id="_特殊な代入操作"><a class="anchor" href="#_特殊な代入操作"></a>特殊な代入操作</h3>
<div class="paragraph">
<p>代入操作 <code>:=</code> は一般的であり、すべての型に対して機能します。</p>
</div>
<div class="paragraph">
<p>また、Motoko には、代入と二項演算（2つの数から新たな数を決定する演算）を組み合わせた特殊な代入操作もあります。代入値は、与えられたオペランド（被演算子）に対する二項演算と、代入された変数の現在の値を使用します。</p>
</div>
<div class="paragraph">
<p>例えば数字では、加算と同時に代入することが可能です：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">var num2 = 2;
num2 += 40;
num2</code></pre>
</div>
</div>
<div class="paragraph">
<p>2行目以降の変数 <code>num2</code> には、期待する通り <code>42</code> が格納されます。</p>
</div>
<div class="paragraph">
<p>Motoko には、他の代入と二項演算の組み合わせもあります。例えば、<code>text2</code> を更新する上の行を、より簡潔に次のように書き換えることができます：</p>
</div>
<div class="listingblock include_init">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">text2 #= "xyz";
text2</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>+=</code> と同様に、代入される変数の名前を（特殊）代入演算子 <code>#=</code> の右側で繰り返すことを避けることができます。</p>
</div>
<div class="paragraph">
<p><a href="language-manual.html#syntax-ops-assignment">代入演算の全リスト</a>に、適切な型（数値、ブール、テキスト値）に対する数値、論理、テキストの演算の一覧が記載されています。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ミュータブルなメモリからの読み込み"><a class="anchor" href="#_ミュータブルなメモリからの読み込み"></a>ミュータブルなメモリからの読み込み</h2>
<div class="sectionbody">
<div class="paragraph">
<p>各変数を更新する際には、特殊な構文なしに、ミュータブルな値を最初に <em>読み込み</em> しています。</p>
</div>
<div class="paragraph">
<p>これは細かいポイントを示しています。それぞれのミュータブルな変数の使用は、イミュータブルな変数の使用のように <em>見え</em> ますが、実際にはイミュータブルな変数のようには <em>動作</em> しません。
実際、その意味はさらに複雑です。すべての言語ではありませんが、多くの言語（JavaScript、Java、C# など）では、それぞれの構文は、その変数で特定されるメモリのセルにアクセスして現在の値を取得する <em>メモリ効果</em> を隠蔽しています。関数型言語の伝統を持つ他の言語（SML、OCaml、Haskell など）では、一般的にこれらの作用を構文的に公開しています。</p>
</div>
<div class="paragraph">
<p>以下では，この点について詳しく説明します：</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_var_と_let_の違いについて理解する"><a class="anchor" href="#_var_と_let_の違いについて理解する"></a><code>var</code> と <code>let</code> の違いについて理解する</h2>
<div class="sectionbody">
<div class="paragraph">
<p>次の2つのよく似た変数宣言を考えてみましょう：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">let x : Nat = 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>と</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">var x : Nat = 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>これらの構文の唯一の違いは変数 <code>x</code> を定義するのにキーワード <code>let</code> と <code>var</code> を使用していることで、いずれもプログラムは <code>0</code> に初期化します。</p>
</div>
<div class="paragraph">
<p>しかしながら、これらのプログラムは異なる意味を持っており、より大きなプログラムの文脈では、その意味の違いが <code>x</code> の使われ方の意味に影響を及ぼします。</p>
</div>
<div class="paragraph">
<p><code>let</code> を使用している最初のプログラムでは、<code>x</code> が <code>0</code> であることを <em>意味して</em> います。 <code>x</code> が使われている箇所を <code>0</code> に置き換えても、プログラムの意味は変わりません。</p>
</div>
<div class="paragraph">
<p><code>var</code> を使った2つ目のプログラムでは、それぞれの <code>x</code> は「<code>x</code> という名前の、ミュータブルなメモリセルの現在の値を読み込んで生成する」ということを <em>意味して</em> います。
この場合、それぞれの <code>x</code> の値は動的な状態（<code>x</code> という名前のミュータブルなメモリセルの内容）によって決定されます。</p>
</div>
<div class="paragraph">
<p>上記の定義からわかるように、<code>let</code> に束縛された変数と <code>var</code> に束縛された変数の意味には根本的な違いがあります。</p>
</div>
<div class="paragraph">
<p>大規模なプログラムでは、どちらの種類の変数も有用であり、どちらかがもう一方のよい代替とはなりません。</p>
</div>
<div class="paragraph">
<p>ただし、<code>let</code> 変数はより基本的なものです。</p>
</div>
<div class="paragraph">
<p>その理由を知るため、<code>let</code> 変数 1 要素のミュータブルな配列を使って、<code>var</code> 変数を書き表すことを考えてみましょう。</p>
</div>
<div class="paragraph">
<p>例えば、<code>0</code> で初期化されたミュータブルな変数として <code>x</code> を宣言することは、1 要素（<code>0</code>）のミュータブルな配列を示す、イミュータブルな変数 <code>y</code> によって代替することが可能です：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">var x : Nat       = 0 ;
let y : [var Nat] = [var 0] ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>ミュータブルな配列の詳細については<a href="#mutable-arrays">以下</a>で説明します。</p>
</div>
<div class="paragraph">
<p>残念ながら、この書き方に用いた読み書きの構文は、ミュータブルな配列の構文を再利用しており、<code>var</code> 変数の構文ほど読みやすくありません。
つまり、変数 <code>x</code> の読み書きの仕方は、変数 <code>y</code> の読み書きの仕方よりも読みやすいです。</p>
</div>
<div class="paragraph">
<p>このような実用上の理由から、<code>var</code> 変数は、言語設計の中核をなすものです。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="immutable-arrays"><a class="anchor" href="#immutable-arrays"></a>イミュータブルな配列</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#mutable-arrays">ミュータブルな配列</a>について説明する前に、同じ射影（値の抽出）の構文を持ち、割り当て後の可変的な更新（代入）を許可しないイミュータブルな配列について説明します。</p>
</div>
<div class="sect2">
<h3 id="_イミュータブルな定数配列の割り当て"><a class="anchor" href="#_イミュータブルな定数配列の割り当て"></a>イミュータブルな定数配列の割り当て</h3>
<div id="array" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">let a : [Nat] = [1, 2, 3] ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>上の配列 <code>a</code> は3つの自然数を保持しており、型は <code>[Nat]</code> です。
一般に、イミュータブルな配列の型は <code>[_]</code> であり、配列の要素の型を角括弧で囲んで表現します。要素の型は配列内で共通となる単一の型である必要があり、今回の場合は <code>Nat</code> です。</p>
</div>
</div>
<div class="sect2">
<h3 id="_配列のインデックスからの射影値の読み込みについて"><a class="anchor" href="#_配列のインデックスからの射影値の読み込みについて"></a>配列のインデックスからの射影（値の読み込み）について</h3>
<div class="paragraph">
<p>配列からの射影（<em>読み込み</em>）には、角括弧（<code>[</code> と <code>]</code>）でアクセスしたいインデックスを囲む、よくあるブラケット構文を用いることができます：</p>
</div>
<div class="listingblock include_array">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">let x : Nat = a[2] + a[0] ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Motoko において配列へのアクセスはすべて安全です。
範囲外へのアクセスは危険なメモリアクセスを引き起こさず、代わりに <a href="basic-concepts.html#overview-traps">アサーションの失敗</a>のようにプログラムがトラップされます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_配列モジュール"><a class="anchor" href="#_配列モジュール"></a>配列モジュール</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Motoko 標準ライブラリは、ミュータブルな配列およびイミュータブルな配列に対する基本的な操作を提供しています。以下のようにインポートできます。</p>
</div>
<div id="import" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">import Array "mo:base/Array";</code></pre>
</div>
</div>
<div class="paragraph">
<p>この章では、最も頻繁に使用される配列操作について説明します。
配列の使い方の詳細については、<a href="stdlib/array.html">配列</a>ライブラリの説明をご覧ください。</p>
</div>
<div class="sect2">
<h3 id="_イミュータブルな配列へのさまざまな要素の割り当て"><a class="anchor" href="#_イミュータブルな配列へのさまざまな要素の割り当て"></a>イミュータブルな配列へのさまざまな要素の割り当て</h3>
<div class="paragraph">
<p>上記では、イミュータブルな配列を作成するためのごく限られた方法を示しました。</p>
</div>
<div class="paragraph">
<p>一般的に、プログラムによって割り当てられた新しい配列はさまざまな値を含みます。突然値が変わるようなことがないのであれば、要素群を割り当ての引数で "一度に" 指定する方法が必要です。</p>
</div>
<div class="paragraph">
<p>このようなニーズに対応するために、Motoko 言語では、要素ごとに値を決めるためにユーザー指定の "生成関数" である <code>gen</code> を参照する、<em>高次の</em> 配列割り当て関数 <code>Array.tabulate</code> を用意しています。</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">func tabulate&lt;T&gt;(size : Nat,  gen : Nat -&gt; T) : [T]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>gen</code> 関数は、アロー関数型 <code>Nat &#8594; T</code> （ここで <code>T</code> は最終的な配列要素の型）の <em>関数値</em> として配列を指定します。</p>
</div>
<div class="paragraph">
<p><code>gen</code> 関数は、配列の初期化時に配列として実際に <em>機能</em> します。つまり、配列要素のインデックスを受け取り、そのインデックスに割り当てられる（<code>T</code> 型の）要素を生成して返します。
出力された配列は、<code>gen</code> 関数の指定に基づいて自らの配列に値を追加します。</p>
</div>
<div class="paragraph">
<p>例えば、最初にいくつかの初期定数からなる <code>array1</code> を割り当て、次にインデックスの一部を（純粋な、関数型な方法で）変更してアップデートを行い、2番目の配列である <code>array2</code> を非破壊的に生成することができます。</p>
</div>
<div class="listingblock include_import">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">let array1 : [Nat] = [1, 2, 3, 4, 6, 7, 8] ;

let array2 : [Nat] = Array.tabulate&lt;Nat&gt;(7, func(i:Nat) : Nat {
    if ( i == 2 or i == 5 ) { array1[i] * i } // 3番目と6番目の要素を変更
    else { array1[i] } // 他の要素は変更なし
  }) ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>関数型の要領で <code>array1</code> を <code>array2</code> に変更しているものの、両方の配列と両方の変数はイミュータブルであることに注意してください。</p>
</div>
<div class="paragraph">
<p>次に、根本的に異なる <em>ミュータブル</em> な配列について考えてみましょう。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ミュータブルな配列"><a class="anchor" href="#_ミュータブルな配列"></a>ミュータブルな配列</h2>
<div class="sectionbody">
<div id="mutable-arrays" class="paragraph">
<p>上ではミュータブルな配列と同じ射影の構文を持つ <em>イミュータブルな配列</em> を紹介しましたが、イミュータブルな配列は値の割り当て後のミュータブルな更新（割り当て）を許可していません。イミュータブルな配列とは異なり、Motoko のミュータブルな配列は、（プライベートで）ミュータブルな Actor のステートを導入します。</p>
</div>
<div class="paragraph">
<p>Motoko の型システムでは、リモートの Actor がミュータブルなステートを共有しないことを強制しているため、ミュータブルな配列とイミュータブルな配列との間に確固たる区別がされており、これは型付け・サブタイピング・非同期通信のための言語抽象化に影響を与えています。</p>
</div>
<div class="paragraph">
<p>より身近な例として、ミュータブルな配列はイミュータブルな配列を想定している場所では使用できません。これは、Motoko における配列の <a href="language-manual.html#subtyping">サブタイピング</a> の定義が、型健全性の目的でそれらのケースを（正しく）区別しているためです。</p>
</div>
<div class="paragraph">
<p>加えて、Actor 通信の観点では、イミュータブルな配列は送信したり共有したりしても安全ですが、ミュータブルな配列はメッセージで共有したり送信したりすることはできません。
イミュータブルな配列とは異なり、ミュータブルな配列は <em>共有不可型</em> を持ちます。</p>
</div>
<div class="sect2">
<h3 id="_ミュータブルな定数配列の割り当て"><a class="anchor" href="#_ミュータブルな定数配列の割り当て"></a>ミュータブルな定数配列の割り当て</h3>
<div class="paragraph">
<p><em>ミュータブルな</em> 配列の割り当てであることを示すために（<em>イミュータブルな</em> 配列の形式とは対照的に）、ミュータブルな配列の構文 <code>[var _]</code> では、式と型の両方で <code>var</code> キーワードを使用します：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">let a : [var Nat] = [var 1, 2, 3] ;</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記の例と同様に、配列 <code>a</code> は3つの自然数を保持していますが、型は <code>[var Nat]</code> です。</p>
</div>
</div>
<div class="sect2">
<h3 id="_動的サイズのミュータブルな配列の割り当て"><a class="anchor" href="#_動的サイズのミュータブルな配列の割り当て"></a>動的サイズのミュータブルな配列の割り当て</h3>
<div class="paragraph">
<p>サイズが一定でないミュータブルな配列を割り当てるには、<code>Array_init</code> プリミティブを使用して、初期値を指定します：</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">func init&lt;T&gt;(size : Nat,  x : T) : [var T]</code></pre>
</div>
</div>
<div class="paragraph">
<p>例えば：</p>
</div>
<div class="listingblock include_import">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">var size : Nat = 42 ;
let x : [var Nat] = Array.init&lt;Nat&gt;(size, 3);</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで、<code>size</code> は定数である必要はありません。
配列は <code>size</code> 個の要素を持ち、それぞれが初期値である <code>3</code> を保持します。</p>
</div>
</div>
<div class="sect2">
<h3 id="_ミュータブルな更新"><a class="anchor" href="#_ミュータブルな更新"></a>ミュータブルな更新</h3>
<div class="paragraph">
<p>ミュータブルな配列は、それぞれ <code>[var _]</code> という型を持ち、個々の要素への代入によるミュータブルな更新を許可します。以下の例では、要素のインデックス <code>2</code> が保持していた <code>3</code> の代わりに値 <code>42</code> を保持するように更新されます：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">let a : [var Nat] = [var 1, 2, 3];
a[2] := 42;
a</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="intro-array-subtyping"><a class="anchor" href="#intro-array-subtyping"></a>サブタイピングでは、<em>ミュータブル</em> を <em>イミュータブル</em> として使用することはできません</h3>
<div class="paragraph">
<p>Motoko のサブタイピングでは、<code>[Nat]</code> 型のイミュータブルな配列を期待する場所で、<code>[var Nat]</code> 型のミュータブルな配列を使用することはできません。</p>
</div>
<div class="paragraph">
<p>これには2つの理由があります。
第一に、すべてのミュータブルなステートと同様、ミュータブルな配列は健全なサブタイピングのために異なるルールを必要とします。
特に、ミュータブルな配列は、必然的に柔軟性の低いサブタイピングの定義を持ちます。
第二に、Motoko は <a href="actors-async.html">非同期通信</a> でのミュータブルな配列の使用を禁止しており、ミュータブルなステートは決して共有されません。</p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar">
  
  <div class="toc-menu"></div>
</aside></div>
</main></div>
<footer class="footer">
  <div class="footer-container">
    <a href="http://www.dfinity.org"><img class="footer-logo" src="../../_/img/logo.svg"></a>
    <nav class="footer-nav">
      <div class="col1">
        <h5 class="footer-header">Developers</h5>
        <a class="footer-link" href="http://www.dfinity.org/faq">
          FAQ
        </a>
        <a class="footer-link" href="#">
          Developers
        </a>
        <a class="footer-link" href="http://www.dfinity.org/data-centers">
          Data Centers
        </a>
      </div>

      <div class="col2">
        <h5 class="footer-header">Team</h5>
        <a class="footer-link" href="http://www.dfinity.org/foundation">
          Foundation
        </a>
        <a class="footer-link" href="http://www.dfinity.org/foundation#events">
          Events
        </a>
        <a class="footer-link" href="http://www.dfinity.org/careers">
          Careers
        </a>
      </div>


      <div class="col3">
        <h5 class="footer-header">Media</h5>
        <a class="footer-link" href="http://www.dfinity.org/media">
          Featured Videos
        </a>
        <a class="footer-link" href="http://www.dfinity.org/media#featured-stories">
          Featured Stories
        </a>
        <a class="footer-link" href="http://www.dfinity.org/newsletter">
          Newsletter
        </a>
      </div>

      <div class="social-icons">

        <a class="social-icon-link" target="blank" href="https://github.com/dfinity">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M12 0C5.3625 0 0 5.3625 0 12C0 17.2875 3.45 21.7875 8.2125 23.4C8.8125 23.5125 9.0375 23.1375 9.0375 22.8375C9.0375 22.5375 9.0375 21.7875 9.0375 20.8125C5.7 21.525 4.9875 19.2 4.9875 19.2C4.425 17.8125 3.6375 17.4375 3.6375 17.4375C2.55 16.6875 3.7125 16.725 3.7125 16.725C4.9125 16.8 5.55 17.9625 5.55 17.9625C6.6375 19.8 8.3625 19.275 9.0375 18.975C9.15 18.1875 9.45 17.6625 9.7875 17.3625C7.125 17.0625 4.3125 16.0125 4.3125 11.4375C4.3125 10.125 4.7625 9.075 5.55 8.2125C5.4375 7.9125 5.025 6.675 5.6625 5.025C5.6625 5.025 6.675 4.6875 8.9625 6.2625C9.9375 6 10.95 5.85 11.9625 5.85C12.975 5.85 14.025 6 14.9625 6.2625C17.25 4.725 18.2625 5.025 18.2625 5.025C18.9 6.675 18.4875 7.9125 18.375 8.2125C19.1625 9.0375 19.6125 10.125 19.6125 11.4375C19.6125 16.05 16.8 17.0625 14.1375 17.3625C14.55 17.7375 14.9625 18.45 14.9625 19.575C14.9625 21.1875 14.9625 22.4625 14.9625 22.875C14.9625 23.2125 15.1875 23.5875 15.7875 23.4375C20.55 21.7875 24 17.2875 24 12C24 5.3625 18.6375 0 12 0Z"
              fill="#333333" />
          </svg>

        </a>
        <a class="social-icon-link" target="blank" href="https://medium.com/dfinity-network-blog">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M22.3125 1H1.6875C1.50516 1 1.3303 1.07243 1.20136 1.20136C1.07243 1.3303 1 1.50516 1 1.6875L1 22.3125C1 22.4948 1.07243 22.6697 1.20136 22.7986C1.3303 22.9276 1.50516 23 1.6875 23H22.3125C22.4948 23 22.6697 22.9276 22.7986 22.7986C22.9276 22.6697 23 22.4948 23 22.3125V1.6875C23 1.50516 22.9276 1.3303 22.7986 1.20136C22.6697 1.07243 22.4948 1 22.3125 1V1ZM19.2768 6.21228L18.0971 7.34356C18.0471 7.38153 18.0085 7.43245 17.9854 7.4908C17.9623 7.54916 17.9557 7.61272 17.9661 7.67459V15.9875C17.9557 16.0494 17.9623 16.1129 17.9854 16.1713C18.0085 16.2296 18.0471 16.2806 18.0971 16.3185L19.2493 17.4498V17.698H13.4534V17.4498L14.6469 16.2903C14.7641 16.1731 14.7641 16.1388 14.7641 15.9593V9.24072L11.4455 17.6698H10.9987L7.13319 9.24072V14.8899C7.11729 15.0071 7.12828 15.1264 7.16533 15.2387C7.20237 15.351 7.2645 15.4535 7.347 15.5382L8.89937 17.4213V17.6695H4.49731V17.4213L6.04969 15.5382C6.13152 15.4534 6.19226 15.3505 6.22701 15.2379C6.26177 15.1253 6.26956 15.0061 6.24975 14.8899V8.35866C6.25855 8.26945 6.24627 8.17943 6.21391 8.09584C6.18155 8.01225 6.13001 7.93743 6.06344 7.87741L4.68362 6.21503V5.96684H8.96847L12.2805 13.2303L15.1924 5.96684H19.2768V6.21228Z"
              fill="#333333" />
          </svg>

        </a>
        <a class="social-icon-link" target="blank" href="https://twitter.com/dfinity">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M23 5.33654C22.175 5.67308 21.3156 5.94231 20.4219 6.04327C21.35 5.50481 22.0719 4.62981 22.4156 3.58654C21.5562 4.09135 20.5938 4.46154 19.5625 4.66346C18.7031 3.78846 17.5344 3.25 16.2281 3.25C13.7187 3.25 11.725 5.23558 11.725 7.65865C11.725 7.99519 11.7594 8.33173 11.8281 8.66827C8.08125 8.5 4.74688 6.71635 2.54688 4.05769C2.16875 4.69712 1.92813 5.47115 1.92813 6.27885C1.92813 7.82692 2.71875 9.17308 3.92188 9.94712C3.16562 9.91346 2.47812 9.71154 1.89375 9.40865C1.89375 9.44231 1.89375 9.44231 1.89375 9.47596C1.89375 11.6298 3.44063 13.4135 5.50313 13.8173C5.125 13.9183 4.7125 13.9856 4.3 13.9856C4.025 13.9856 3.71562 13.9519 3.44062 13.9183C4.025 15.6683 5.675 16.9471 7.66875 16.9808C6.12187 18.1587 4.1625 18.8654 2.06562 18.8654C1.6875 18.8654 1.34375 18.8317 1 18.7981C2.99375 20.0096 5.36563 20.75 7.90938 20.75C16.2281 20.75 20.7656 14.0192 20.7656 8.16346C20.7656 7.96154 20.7656 7.79327 20.7656 7.59135C21.625 6.98558 22.3813 6.21154 23 5.33654Z"
              fill="#333333" />
          </svg>

        </a>

        <a class="social-icon-link" target="blank" href="https://forum.dfinity.org/">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12.0932 1C6.0727 1 1 5.83706 1 11.8085C1 12 1.00488 23 1.00488 23L12.0933 22.9901C18.1188 22.9901 23 17.9666 23 11.9951C23 6.02373 18.1188 1 12.0932 1ZM12 18.2857C11.0473 18.2857 10.1388 18.0745 9.32853 17.6916L5.34597 18.6786L6.47047 14.9956C5.98926 14.1067 5.71423 13.0853 5.71423 12C5.71423 8.52815 8.52811 5.71428 12 5.71428C15.4719 5.71428 18.2857 8.52815 18.2857 12C18.2857 15.472 15.4719 18.2857 12 18.2857Z"
              fill="#333333" />
          </svg>

        </a>

        <a class="social-icon-link" target="blank" href="https://www.linkedin.com/company/dfinity'">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M1 4.35878C1 3.01688 2.03589 2 3.61924 2C5.20139 2 6.17406 3.01448 6.20507 4.35519C6.20507 5.67205 5.20139 6.71456 3.58942 6.71456H3.55841C2.00666 6.71456 1 5.67562 1 4.35878ZM17.5581 8.28158C15.1017 8.28158 13.5625 9.61217 13.278 10.5449V8.41225H8.46122C8.52324 9.54475 8.46122 21.9995 8.46122 21.9995H13.278V14.647C13.278 14.5987 13.2778 14.5505 13.2775 14.5025C13.2756 14.1436 13.2736 13.7952 13.383 13.5365C13.714 12.7194 14.4255 11.8719 15.7046 11.8719C17.3775 11.8719 18.1378 13.128 18.1378 14.9685V21.9995H23V14.4448C23 10.236 20.6056 8.28158 17.5581 8.28158ZM1.55371 8.41275H5.84157V22H1.55371V8.41275Z"
              fill="#333333" />
          </svg>

        </a>

        <a class="social-icon-link" target="blank" href="https://youtube.com/dfinity">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M23.775 7.6375C23.775 7.6375 23.55 5.9875 22.8375 5.2375C21.9375 4.3 20.8875 4.2625 20.4375 4.225C17.025 4 12 4 12 4C12 4 6.975 4 3.6 4.225C3.1125 4.2625 2.1 4.3 1.2 5.2375C0.4875 5.95 0.2625 7.6375 0.2625 7.6375C0.2625 7.6375 0 9.5875 0 11.5375V13.375C0 15.325 0.225 17.275 0.225 17.275C0.225 17.275 0.45 18.925 1.1625 19.675C2.0625 20.6125 3.2625 20.6125 3.825 20.6875C5.7375 20.875 12 20.9125 12 20.9125C12 20.9125 17.025 20.9125 20.4 20.65C20.8875 20.6125 21.9 20.575 22.8 19.6375C23.5125 18.925 23.7375 17.2375 23.7375 17.2375C23.7375 17.2375 24 15.2875 24 13.3375V11.5C24 9.5875 23.775 7.6375 23.775 7.6375ZM9.525 15.55V8.8L16.0125 12.175L9.525 15.55Z"
              fill="#333333" />
          </svg>

        </a>

      </div>
    </nav>

    <div class="legal-container">
      <span class="legal" id="year">
        © 2020 DFINITY
      </span>
      <a class="legal footer-link" href="http://www.dfinity.org/terms-of-use">
        Terms of Use
      </a>
      <a class="legal footer-link" href="http://www.dfinity.org/cookie-policy">
        Cookie Policy
      </a>
      <a class="legal footer-link" href="http://www.dfinity.org/privacy-policy">
        Privacy Policy
      </a>
    </div>

  </div>
</footer>


<script>
  var today = new Date();
  var year = today.getFullYear();
  document.getElementById("year").innerHTML = `© ${year} DFINITY`;
</script><script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
    apiKey: 'b93d56cc4b00b0afbcdaacab04dcf25b',
    indexName: 'dfinity_sdk',
    inputSelector: '.search-input',
    debug: false // Set debug to true if you want to inspect the dropdown
  });
</script>

<!-- Start of dfinity Zendesk Widget script -->
<script id="ze-snippet" src="https://static.zdassets.com/ekr/snippet.js?key=53121947-c10a-484c-b99b-f89a9fb6f63e"> </script>
<!-- End of dfinity Zendesk Widget script -->

<script src="../../_/js/vendor/run_repl.js"></script>
<script type="module">
  import {CodeJar} from 'https://cdn.jsdelivr.net/npm/codejar@3.2.3/codejar.min.js';
  import {withLineNumbers} from 'https://cdn.jsdelivr.net/npm/codejar@3.2.3/linenumbers.js';
  window.CodeJar = CodeJar;
  window.withLineNumbers = withLineNumbers;
</script> 
<script type="text/javascript">
async function addPackage(name, repo, version, dir) {
  const meta_url = `../../_/js/vendor/${repo}/flat`;
  const base_url = `../../_/js/vendor/${repo}`;
  const response = await fetch(meta_url);
  const json = await response.json()
  const promises = [];
  const fetchedFiles = [];
  for (const f of json.files) {
    if (f.name.startsWith(`/${dir}/`) && /\.mo$/.test(f.name)) {
      const promise = (async () => {
        const content = await (await fetch(base_url + f.name)).text();
        const stripped = name + f.name.slice(dir.length + 1);
        fetchedFiles.push(stripped);
        Motoko.saveFile(stripped, content);
      })();
      promises.push(promise);
    }
  }
  Promise.all(promises).then(() => {
    Motoko.addPackage(name, name + '/');
    console.log("base library loaded");
    changeCodeBlock(); // from run_repl.js
  });
}
function loadBase() {
  addPackage('base', 'dfinity/motoko-base', 'moc-0.6.27', 'src');
}
</script>
<script async src="../../_/js/vendor/moc.js" onload="loadBase()">
</script>
  </body>
</html>
