<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ステーブル（Stable）変数とアップグレード方法 :: Motoko documentation</title>
    <meta name="generator" content="Antora 2.3.4">
<link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /><meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:title" content="The Internet Computer | Documentation" />
<meta property="og:description" content="Documentation for the internet computer." />
<meta property="og:image" content="../../_/img/share.jpg" />
<meta property="og:image:url" content="../../_/img/share.jpg" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@DFINITYDev" />
<meta name="twitter:image" content="../../_/img/logo-RGB.png" />
<meta name="twitter:image:alt" content="DFINITY Logo" />    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="logo-container" href="https://dfinity.org/">
        <img class="header-logo" src="../../_/img/logo.svg">
        <h1 class="header-title">Motoko documentation</h1>
      </a>
    </div>
    <div class="nav-items-wrapper">
      <div class="search-container">
  <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd"
      d="M11.8654 12.5892C10.8213 13.4695 9.47259 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8C14 9.47209 13.4699 10.8204 12.5901 11.8643L17.3625 16.6367L16.6377 17.3615L11.8654 12.5892ZM12.9333 8C12.9333 10.7246 10.7246 12.9333 8 12.9333C5.2754 12.9333 3.06667 10.7246 3.06667 8C3.06667 5.2754 5.2754 3.06667 8 3.06667C10.7246 3.06667 12.9333 5.2754 12.9333 8Z"
      fill="black" />
  </svg>


  <input class="search-input" placeholder="Search" type="search" />
</div>      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div id="topbar-nav" class="navbar-menu">
        <div class="navbar-end">
          <a class="navbar-item" target="blank" href="https://forum.dfinity.org/">Forum</a>
          <a class="navbar-item" target="blank" href="mailto:support@dfinity.org?subject=Feedback - SDK Developer Center">Email us</a>
          <a class="navbar-item" target="blank" href="https://www.twitter.com/dfinitydev">
            <img src="../../_/img/social/twitter-icon.svg">
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">docs</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">docs</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="file:///build/doc/modules/language-guide/pages/upgrades.adoc"><svg class="edit-icon" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/><path d="M0 0h24v24H0z" fill="none"/></svg></a></div>
</div>
<div class="main-content">
<article class="doc">
<h1 class="page">ステーブル（Stable）変数とアップグレード方法</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Internet Computer の重要な特徴の一つは、従来のデータベースとは異なり、WebAssembly のメモリとグローバルを使用することで、Canister のスマートコントラクトのステートを永続化できることです。これは、明示的なユーザーの指示なしに、Canister のステート全体が各メッセージの前に魔法のように復元され、後に保存されることを意味します。この自動的でユーザーに影響を与えない（user-transparent）ステートの保存は、<em>直交永続性（orthogonal persistence）</em> と呼ばれています。</p>
</div>
<div class="paragraph">
<p>直交永続性は便利ですが、Canister のコードを更新する際に課題が生じます。
Canister のステートを明示的に表現することなく、引退した Canister から新たな Canister にアプリケーションのデータをどのように移行すればよいのでしょうか。</p>
</div>
<div class="paragraph">
<p>データを失うことなくアップグレードに対応するには、Canister の重要なデータをアップグレード後の Canister に <em>移行</em> するための新しい機能が必要です。
たとえば、ユーザ登録を行う Canister があったとし、問題を修正したり新たな機能を追加したりするために新しいバージョンをデプロイしたい場合、すでに登録されているユーザ情報がアップグレード処理後に失われないようにする必要があります。</p>
</div>
<div class="paragraph">
<p>Internet Computer の永続化モデルにより、Canister はこのようなデータを専用の <em>ステーブルメモリ（stable memory）</em> に保存し、復元することができます。ステーブルメモリは通常の Canister メモリとは異なり、アップグレードしても保持されるので、Canister はデータを一括して新たな Canister に転送することができます。</p>
</div>
<div class="paragraph">
<p>Motoko で書かれたアプリケーションでは、Internet Computer のステーブルメモリを活用したステート保持のための高レベルなサポートが提供されます。この高レベルの機能は <em>ステーブルストレージ（stable storage）</em> と呼ばれ、アプリケーションのデータと、コードを生成するために使用される Motoko コンパイラの両方への変更に対応するように設計されています。</p>
</div>
<div class="paragraph">
<p>ステーブルストレージの活用はアプリケーションプログラマであるあなた次第であり、アップグレード後も保持したいデータを予測し、指示することが必要です。
アプリケーションによって、永続化するデータは、ある Actor のステートの一部かすべて、または一切ない可能性もあります。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ステーブル変数の宣言"><a class="anchor" href="#_ステーブル変数の宣言"></a>ステーブル変数の宣言</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Actor では、変数宣言の修飾子として <code>stable</code> キーワードを使用することで、変数をステーブルストレージ（Internet Computer ステーブルメモリ）に登録することができます。</p>
</div>
<div class="paragraph">
<p>より正確には、Actor 内のすべての <code>let</code> と <code>var</code> の変数宣言において、その変数が <code>stable</code> と <code>flexible</code> のどちらであるかを指定することができます。
修飾子を指定しなかった場合、変数はデフォルトで <code>flexible</code> として宣言されます。</p>
</div>
<div class="paragraph">
<p>以下に、カウンタの値を保持したままアップグレードすることができる、ステーブルなカウンタを宣言するための簡単な例を示します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">actor Counter {

  stable var value = 0;

  public func inc() : async Nat {
    value += 1;
    return value;
  };
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>stable</code> または <code>flexible</code> 修飾子は、 <strong>Actor フィールド</strong> の <code>let</code> および <code>var</code> 宣言にのみ使用することができます。これらの修飾子は、プログラム中の他の場所では使用できません。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_型付けtyping"><a class="anchor" href="#_型付けtyping"></a>型付け（Typing）</h2>
<div class="sectionbody">
<div class="paragraph">
<p>コンパイラは、アップグレード後のプログラムにおいて、ステーブル変数が互換性と意味を持つことを保証しなければならないため、ステーブルなステートには以下の型制約が適用されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>すべての <code>stable</code> 変数は <em>stable</em> 型を持たなければなりません。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ここで、<code>var</code> 修飾子を無視したときに型が <em>shared</em> であれば、<em>stable</em> 型となります。</p>
</div>
<div class="paragraph">
<p>したがって、stable 型と shared 型の唯一の違いは、前者はミュータブルな更新（mutation）をサポートしていることです。
shared 型と同様に、stable 型はローカル関数とローカル関数から構築された構造体（オブジェクトなど）を除外した一次データ（first-order data）に限定されます。
このように関数を除外する必要があるのは、データとコードの両方からなる関数値の意味は、アップグレードの際に容易に保存できないからです。一方、プレーンデータの意味は、ミュータブルかどうかにかかわらず保存可能です。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
一般的に、オブジェクト型はローカル関数を含むことができるため、ステーブルではありません。
しかし、ステーブルなデータのプレーンレコードは、オブジェクト型の特別なケースとしてステーブル型になります。
さらに、Actor や shared 関数への参照もステーブルであるため、アップグレードをまたいでその値を保持することができます。
たとえば、Service を参照している Actor や shared 関数のコールバックを記録するステートを保持することができます。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ステーブル変数のアップグレード方法"><a class="anchor" href="#_ステーブル変数のアップグレード方法"></a>ステーブル変数のアップグレード方法</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Canister を最初にコンパイルしてデプロイするとき、Actor 内のすべてのフレキシブル（flexible）変数とステーブル変数が順番に初期化されます。
<code>upgrade</code> モードを使用して Canister をデプロイすると、Actor の前のバージョンに存在したすべてのステーブル変数が、古い値で事前に初期化されます。
ステーブル変数が以前の値で初期化された後、残りのフレキシブル変数と新しく追加されたステーブル変数が順番に初期化されます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_プリアップグレードpreupgradeおよびポストアップグレードpostupgradeのシステムメソッド"><a class="anchor" href="#_プリアップグレードpreupgradeおよびポストアップグレードpostupgradeのシステムメソッド"></a>プリアップグレード（preupgrade）およびポストアップグレード（postupgrade）のシステムメソッド</h2>
<div class="sectionbody">
<div class="paragraph">
<p>変数を <code>stable</code> なものとして宣言するには、その型もステーブル型である必要があります。
すべての型がステーブルであるわけではないので、いくつかの変数は <code>stable</code> と宣言することができません。</p>
</div>
<div class="paragraph">
<p>簡単な例として、<a href="motoko.html#orthogonal_persistence">直交永続性</a> の議論にある <code>Registry</code> Actor を考えてみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">import Text "mo:base/Text";
import Map "mo:base/HashMap";

actor Registry {

  let map = Map.HashMap&lt;Text, Nat&gt;(10, Text.equal, Text.hash);

  public func register(name : Text) : async () {
    switch (map.get(name)) {
      case null {
        map.put(name, map.size());
      };
      case (?id) { };
    }
  };

  public func lookup(name : Text) : async ?Nat {
    map.get(name);
  };
};

await Registry.register("hello");
(await Registry.lookup("hello"), await Registry.lookup("world"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>この Actor は、<code>map</code> オブジェクトのサイズを使用して次の ID を決定することで、<code>Text</code> 値に連続した ID を割り当てます。
他の Actor と同様に、呼び出しの間にハッシュマップのステートを維持するために <em>直交永続性</em> を頼っています。</p>
</div>
<div class="paragraph">
<p>ここで、私たちはアップグレードによって既存の記録を失なうことなく <code>Register</code> をアップグレード可能にしたいとします。</p>
</div>
<div class="paragraph">
<p>残念なことに、ステートである <code>map</code> はメンバ関数（例えば <code>map.get</code>）を含むオブジェクト型を持っているので、<code>map</code> 変数自身を <code>stable</code> と宣言することはできません。</p>
</div>
<div class="paragraph">
<p>このようなステーブル変数だけでは解決できないシナリオのために、Motoko はユーザー定義のアップグレードフック（upgrade hook）をサポートしており、使用するとアップグレードの前後にすぐさま実行されます。
これらのアップグレードフックによって、制限のないフレキシブル変数と、より制限のあるステーブル変数との間でステートを移行させることができます。
これらのフックは <code>system</code> 関数として宣言され、特別な名前（<code>preugrade</code> と <code>postupgrade</code>）がついています。どちらの関数も型は <code>: () &#8594; ()</code> である必要があります。</p>
</div>
<div class="paragraph">
<p><code>preupgrade</code> メソッドを使用すると、ランタイムがステーブルメモリに値をコミットしてアップグレードを行う前に、ステーブル変数に最終的な更新を行うことができます。
<code>postupgrade</code> メソッドは、アップグレードがステーブル変数を含む新たな Actor を初期化した後、その Actor で shared 関数の呼び出し（メッセージ）を行う前に実行されます。</p>
</div>
<div class="paragraph">
<p>ここでは、新しいステーブル変数 <code>entries</code> を導入し、stable でないハッシュテーブルのエントリを保存・復元します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">import Text "mo:base/Text";
import Map "mo:base/HashMap";
import Array "mo:base/Array";
import Iter "mo:base/Iter";

actor Registry {

  stable var entries : [(Text, Nat)] = [];

  let map = Map.fromIter&lt;Text,Nat&gt;(
    entries.vals(), 10, Text.equal, Text.hash);

  public func register(name : Text) : async () {
    switch (map.get(name)) {
      case null  {
        map.put(name, map.size());
      };
      case (?id) { };
    }
  };

  public func lookup(name : Text) : async ?Nat {
    map.get(name);
  };

  system func preupgrade() {
    entries := Iter.toArray(map.entries());
  };

  system func postupgrade() {
    entries := [];
  };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>entries</code> の型は、単に <code>Text</code> と <code>Nat</code> のペアの配列であり、実際にステーブル型であることに注目してください。</p>
</div>
<div class="paragraph">
<p>この例では、 <code>preupgrade</code> システムメソッドは、 <code>entries</code> をステーブルメモリに保存する前に、現在の <code>map</code> エントリを <code>entries</code> に単に書き込んでいます。
<code>postupgrade</code> システムメソッドは、<code>entries</code> から <code>map</code> の空き領域に値を埋めた後、 <code>entries</code> を空の配列にリセットしています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ステーブル型のシグネチャ"><a class="anchor" href="#_ステーブル型のシグネチャ"></a>ステーブル型のシグネチャ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Actor 内のステーブル変数宣言のコレクションは、<em>ステーブルシグネチャ（stable signature）</em> にまとめることができます。</p>
</div>
<div class="paragraph">
<p>Actor のステーブルシグネチャのテキスト表現は Motoko Actor 型の内部構造と似ています。</p>
</div>
<div class="listingblock no-repl">
<div class="content">
<pre class="highlightjs highlight"><code class="language-motoko hljs" data-lang="motoko">actor {
  stable x : Nat;
  stable var y : Int;
  stable z : [var Nat];
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは Actor のステーブルフィールドの名前・型・ミュータブルかどうかを指定しています。
場合によっては関連する Motoko の型宣言を前に行うこともあります。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>moc</code> コンパイラのオプションである <code>--stable-types</code> を使うと、メインの Actor や Actor クラスのステーブルシグネチャを <code>.most</code> ファイルに出力することができます。
そのため、自分で <code>.most</code> ファイルを作成する必要はありません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>ステーブルシグネチャ <code>&lt;stab-sig1&gt;</code> は、以下の場合に限り、シグネチャ <code>&lt;stab-sig2&gt;</code> と <em>ステーブル互換（stable-compatible）</em> となります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;stab-sig1&gt;</code> のすべてのイミュータブルフィールド <code>stable &lt;id&gt; : T</code> は、 <code>&lt;stab-sig2&gt;</code> のフィールド <code>stable &lt;id&gt; : U</code> と一致し、<code>T &lt;: U</code> である（訳注：<code>&lt;:</code> はサブタイプ記号であり、<code>A &lt;: B</code> なら A は B のサブタイプ）。</p>
</li>
<li>
<p><code>&lt;stab-sig1&gt;</code> の全てのミュータブルフィールド <code>stable var &lt;id&gt; : T</code> は <code>&lt;stab-sig2&gt;</code> のフィールド <code>stable var &lt;id&gt; : U</code> とマッチし、<code>T &lt;: U</code> である。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>&lt;stab-sig2&gt;</code> には追加のフィールドが含まれている可能性があることに注意してください。
通常 <code>&lt;stab-sig1&gt;</code> は古いバージョンのシグネチャで、<code>&lt;stab-sig2&gt;</code> は新しいバージョンのシグネチャです。</p>
</div>
<div class="paragraph">
<p>ステーブルフィールドのサブタイピング条件は、あるフィールドの最終的な値が、アップグレード後のコードでそのフィールドの初期値として使われることを保証します。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>moc</code> コンパイラのオプションである <code>--stable-compatible cur.most nxt.most</code> を使用すると、（ステーブルシグネチャを含む）2つの <code>.most</code> ファイル（<code>cur.most</code> と <code>nxt.most</code>）のステーブル互換性（stable-compatiblity）を確認することができます。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>ステーブル互換</em> の関係は、かなり保守的なものです。
将来的には、フィールドのミュータビリティの変更や <code>&lt;stab-sig1&gt;</code> からのフィールドの放棄（ただし警告を伴う）に対応するために緩和されるかもしれません。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_アップグレードの安全性"><a class="anchor" href="#_アップグレードの安全性"></a>アップグレードの安全性</h2>
<div class="sectionbody">
<div class="paragraph">
<p>デプロイされた Canister をアップグレードする前に、アップグレードが安全で、以下のようなことがないことを確認する必要があります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>（Candid インターフェース変更によって）既存のクライアントが壊れる。</p>
</li>
<li>
<p>（ステーブル宣言の互換性のない変更によって）Motoko のステーブルステートを破棄する。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Motoko Canister のアップグレードは、以下の条件を満たせば安全です。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Canister の Candid インターフェースが Candid におけるサブタイプになっている。</p>
</li>
<li>
<p>Canister の Motoko ステーブルシグネチャが、<em>ステーブル互換</em> なものになっている。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>アップグレードの安全性は、アップグレード処理が成功することを保証するものではありません（リソースの制約により失敗する可能性はあります）。
しかし、少なくともアップグレードが成功すれば、既存のクライアントとの Candid 型の互換性が失われたり、<code>stable</code> とマークされていたデータが予期せず失われたりしないことを保証するはずです。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>didc</code> ツールに <code>check nxt.did cur.did</code> という引数を与えることで、（Candid 型を含む) <code>cur.did</code> と <code>nxt.did</code> という <code>.did</code> ファイルに記述された 2 つの Service 間における有効な Candid のサブタイプのチェックを行うことができます。
<code>didc</code> ツールは <a href="https://github.com/dfinity/candid" class="bare">https://github.com/dfinity/candid</a> で入手可能です。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_メタデータセクション"><a class="anchor" href="#_メタデータセクション"></a>メタデータセクション</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Motoko のコンパイラは、Canister の Candid インターフェースとステーブルシグネチャを、Canister のメタデータとして埋め込み、コンパイル済みバイナリの Wasm カスタムセクションに記録します。</p>
</div>
<div class="paragraph">
<p>このメタデータは IC によって選択的に公開され、<code>dfx</code> のようなツールによってアップグレードの互換性を検証するために使用されます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_すでにデプロイされた_actor_または_canister_スマートコントラクトのアップグレード"><a class="anchor" href="#_すでにデプロイされた_actor_または_canister_スマートコントラクトのアップグレード"></a>すでにデプロイされた Actor または Canister スマートコントラクトのアップグレード</h2>
<div class="sectionbody">
<div class="paragraph">
<p>適切な <code>stable</code> 変数、または <code>preupgrade</code> と <code>postupgrade</code> システムメソッドを用いて Motoko Actor をデプロイした後、<code>dfx canister install</code> コマンドに <code>--mode=upgrade</code> オプションを指定すると、既にデプロイしたバージョンをアップグレードすることが可能です。
デプロイされた Canister のアップグレードに関する情報は <a href="../developers-guide/working-with-canisters.html#upgrade-canister">Canister スマートコントラクトのアップグレード</a> を参照してください。</p>
</div>
<div class="paragraph">
<p>今後の <code>dfx</code> のバージョンでは、デプロイされたバイナリとアップグレードバイナリに埋め込まれた Candid と (Motoko で書かれた Canister のみ) ステーブルシグネチャを比較してアップグレードの安全性を確認し、安全ではない場合はアップグレード要求を中止するようになります。</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar">
  
  <div class="toc-menu"></div>
</aside></div>
</main></div>
<footer class="footer">
  <div class="footer-container">
    <a href="http://www.dfinity.org"><img class="footer-logo" src="../../_/img/logo.svg"></a>
    <nav class="footer-nav">
      <div class="col1">
        <h5 class="footer-header">Developers</h5>
        <a class="footer-link" href="http://www.dfinity.org/faq">
          FAQ
        </a>
        <a class="footer-link" href="#">
          Developers
        </a>
        <a class="footer-link" href="http://www.dfinity.org/data-centers">
          Data Centers
        </a>
      </div>

      <div class="col2">
        <h5 class="footer-header">Team</h5>
        <a class="footer-link" href="http://www.dfinity.org/foundation">
          Foundation
        </a>
        <a class="footer-link" href="http://www.dfinity.org/foundation#events">
          Events
        </a>
        <a class="footer-link" href="http://www.dfinity.org/careers">
          Careers
        </a>
      </div>


      <div class="col3">
        <h5 class="footer-header">Media</h5>
        <a class="footer-link" href="http://www.dfinity.org/media">
          Featured Videos
        </a>
        <a class="footer-link" href="http://www.dfinity.org/media#featured-stories">
          Featured Stories
        </a>
        <a class="footer-link" href="http://www.dfinity.org/newsletter">
          Newsletter
        </a>
      </div>

      <div class="social-icons">

        <a class="social-icon-link" target="blank" href="https://github.com/dfinity">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M12 0C5.3625 0 0 5.3625 0 12C0 17.2875 3.45 21.7875 8.2125 23.4C8.8125 23.5125 9.0375 23.1375 9.0375 22.8375C9.0375 22.5375 9.0375 21.7875 9.0375 20.8125C5.7 21.525 4.9875 19.2 4.9875 19.2C4.425 17.8125 3.6375 17.4375 3.6375 17.4375C2.55 16.6875 3.7125 16.725 3.7125 16.725C4.9125 16.8 5.55 17.9625 5.55 17.9625C6.6375 19.8 8.3625 19.275 9.0375 18.975C9.15 18.1875 9.45 17.6625 9.7875 17.3625C7.125 17.0625 4.3125 16.0125 4.3125 11.4375C4.3125 10.125 4.7625 9.075 5.55 8.2125C5.4375 7.9125 5.025 6.675 5.6625 5.025C5.6625 5.025 6.675 4.6875 8.9625 6.2625C9.9375 6 10.95 5.85 11.9625 5.85C12.975 5.85 14.025 6 14.9625 6.2625C17.25 4.725 18.2625 5.025 18.2625 5.025C18.9 6.675 18.4875 7.9125 18.375 8.2125C19.1625 9.0375 19.6125 10.125 19.6125 11.4375C19.6125 16.05 16.8 17.0625 14.1375 17.3625C14.55 17.7375 14.9625 18.45 14.9625 19.575C14.9625 21.1875 14.9625 22.4625 14.9625 22.875C14.9625 23.2125 15.1875 23.5875 15.7875 23.4375C20.55 21.7875 24 17.2875 24 12C24 5.3625 18.6375 0 12 0Z"
              fill="#333333" />
          </svg>

        </a>
        <a class="social-icon-link" target="blank" href="https://medium.com/dfinity-network-blog">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M22.3125 1H1.6875C1.50516 1 1.3303 1.07243 1.20136 1.20136C1.07243 1.3303 1 1.50516 1 1.6875L1 22.3125C1 22.4948 1.07243 22.6697 1.20136 22.7986C1.3303 22.9276 1.50516 23 1.6875 23H22.3125C22.4948 23 22.6697 22.9276 22.7986 22.7986C22.9276 22.6697 23 22.4948 23 22.3125V1.6875C23 1.50516 22.9276 1.3303 22.7986 1.20136C22.6697 1.07243 22.4948 1 22.3125 1V1ZM19.2768 6.21228L18.0971 7.34356C18.0471 7.38153 18.0085 7.43245 17.9854 7.4908C17.9623 7.54916 17.9557 7.61272 17.9661 7.67459V15.9875C17.9557 16.0494 17.9623 16.1129 17.9854 16.1713C18.0085 16.2296 18.0471 16.2806 18.0971 16.3185L19.2493 17.4498V17.698H13.4534V17.4498L14.6469 16.2903C14.7641 16.1731 14.7641 16.1388 14.7641 15.9593V9.24072L11.4455 17.6698H10.9987L7.13319 9.24072V14.8899C7.11729 15.0071 7.12828 15.1264 7.16533 15.2387C7.20237 15.351 7.2645 15.4535 7.347 15.5382L8.89937 17.4213V17.6695H4.49731V17.4213L6.04969 15.5382C6.13152 15.4534 6.19226 15.3505 6.22701 15.2379C6.26177 15.1253 6.26956 15.0061 6.24975 14.8899V8.35866C6.25855 8.26945 6.24627 8.17943 6.21391 8.09584C6.18155 8.01225 6.13001 7.93743 6.06344 7.87741L4.68362 6.21503V5.96684H8.96847L12.2805 13.2303L15.1924 5.96684H19.2768V6.21228Z"
              fill="#333333" />
          </svg>

        </a>
        <a class="social-icon-link" target="blank" href="https://twitter.com/dfinity">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M23 5.33654C22.175 5.67308 21.3156 5.94231 20.4219 6.04327C21.35 5.50481 22.0719 4.62981 22.4156 3.58654C21.5562 4.09135 20.5938 4.46154 19.5625 4.66346C18.7031 3.78846 17.5344 3.25 16.2281 3.25C13.7187 3.25 11.725 5.23558 11.725 7.65865C11.725 7.99519 11.7594 8.33173 11.8281 8.66827C8.08125 8.5 4.74688 6.71635 2.54688 4.05769C2.16875 4.69712 1.92813 5.47115 1.92813 6.27885C1.92813 7.82692 2.71875 9.17308 3.92188 9.94712C3.16562 9.91346 2.47812 9.71154 1.89375 9.40865C1.89375 9.44231 1.89375 9.44231 1.89375 9.47596C1.89375 11.6298 3.44063 13.4135 5.50313 13.8173C5.125 13.9183 4.7125 13.9856 4.3 13.9856C4.025 13.9856 3.71562 13.9519 3.44062 13.9183C4.025 15.6683 5.675 16.9471 7.66875 16.9808C6.12187 18.1587 4.1625 18.8654 2.06562 18.8654C1.6875 18.8654 1.34375 18.8317 1 18.7981C2.99375 20.0096 5.36563 20.75 7.90938 20.75C16.2281 20.75 20.7656 14.0192 20.7656 8.16346C20.7656 7.96154 20.7656 7.79327 20.7656 7.59135C21.625 6.98558 22.3813 6.21154 23 5.33654Z"
              fill="#333333" />
          </svg>

        </a>

        <a class="social-icon-link" target="blank" href="https://forum.dfinity.org/">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12.0932 1C6.0727 1 1 5.83706 1 11.8085C1 12 1.00488 23 1.00488 23L12.0933 22.9901C18.1188 22.9901 23 17.9666 23 11.9951C23 6.02373 18.1188 1 12.0932 1ZM12 18.2857C11.0473 18.2857 10.1388 18.0745 9.32853 17.6916L5.34597 18.6786L6.47047 14.9956C5.98926 14.1067 5.71423 13.0853 5.71423 12C5.71423 8.52815 8.52811 5.71428 12 5.71428C15.4719 5.71428 18.2857 8.52815 18.2857 12C18.2857 15.472 15.4719 18.2857 12 18.2857Z"
              fill="#333333" />
          </svg>

        </a>

        <a class="social-icon-link" target="blank" href="https://www.linkedin.com/company/dfinity'">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
              d="M1 4.35878C1 3.01688 2.03589 2 3.61924 2C5.20139 2 6.17406 3.01448 6.20507 4.35519C6.20507 5.67205 5.20139 6.71456 3.58942 6.71456H3.55841C2.00666 6.71456 1 5.67562 1 4.35878ZM17.5581 8.28158C15.1017 8.28158 13.5625 9.61217 13.278 10.5449V8.41225H8.46122C8.52324 9.54475 8.46122 21.9995 8.46122 21.9995H13.278V14.647C13.278 14.5987 13.2778 14.5505 13.2775 14.5025C13.2756 14.1436 13.2736 13.7952 13.383 13.5365C13.714 12.7194 14.4255 11.8719 15.7046 11.8719C17.3775 11.8719 18.1378 13.128 18.1378 14.9685V21.9995H23V14.4448C23 10.236 20.6056 8.28158 17.5581 8.28158ZM1.55371 8.41275H5.84157V22H1.55371V8.41275Z"
              fill="#333333" />
          </svg>

        </a>

        <a class="social-icon-link" target="blank" href="https://youtube.com/dfinity">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M23.775 7.6375C23.775 7.6375 23.55 5.9875 22.8375 5.2375C21.9375 4.3 20.8875 4.2625 20.4375 4.225C17.025 4 12 4 12 4C12 4 6.975 4 3.6 4.225C3.1125 4.2625 2.1 4.3 1.2 5.2375C0.4875 5.95 0.2625 7.6375 0.2625 7.6375C0.2625 7.6375 0 9.5875 0 11.5375V13.375C0 15.325 0.225 17.275 0.225 17.275C0.225 17.275 0.45 18.925 1.1625 19.675C2.0625 20.6125 3.2625 20.6125 3.825 20.6875C5.7375 20.875 12 20.9125 12 20.9125C12 20.9125 17.025 20.9125 20.4 20.65C20.8875 20.6125 21.9 20.575 22.8 19.6375C23.5125 18.925 23.7375 17.2375 23.7375 17.2375C23.7375 17.2375 24 15.2875 24 13.3375V11.5C24 9.5875 23.775 7.6375 23.775 7.6375ZM9.525 15.55V8.8L16.0125 12.175L9.525 15.55Z"
              fill="#333333" />
          </svg>

        </a>

      </div>
    </nav>

    <div class="legal-container">
      <span class="legal" id="year">
        © 2020 DFINITY
      </span>
      <a class="legal footer-link" href="http://www.dfinity.org/terms-of-use">
        Terms of Use
      </a>
      <a class="legal footer-link" href="http://www.dfinity.org/cookie-policy">
        Cookie Policy
      </a>
      <a class="legal footer-link" href="http://www.dfinity.org/privacy-policy">
        Privacy Policy
      </a>
    </div>

  </div>
</footer>


<script>
  var today = new Date();
  var year = today.getFullYear();
  document.getElementById("year").innerHTML = `© ${year} DFINITY`;
</script><script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
    apiKey: 'b93d56cc4b00b0afbcdaacab04dcf25b',
    indexName: 'dfinity_sdk',
    inputSelector: '.search-input',
    debug: false // Set debug to true if you want to inspect the dropdown
  });
</script>

<!-- Start of dfinity Zendesk Widget script -->
<script id="ze-snippet" src="https://static.zdassets.com/ekr/snippet.js?key=53121947-c10a-484c-b99b-f89a9fb6f63e"> </script>
<!-- End of dfinity Zendesk Widget script -->

<script src="../../_/js/vendor/run_repl.js"></script>
<script type="module">
  import {CodeJar} from 'https://cdn.jsdelivr.net/npm/codejar@3.2.3/codejar.min.js';
  import {withLineNumbers} from 'https://cdn.jsdelivr.net/npm/codejar@3.2.3/linenumbers.js';
  window.CodeJar = CodeJar;
  window.withLineNumbers = withLineNumbers;
</script> 
<script type="text/javascript">
async function addPackage(name, repo, version, dir) {
  const meta_url = `../../_/js/vendor/${repo}/flat`;
  const base_url = `../../_/js/vendor/${repo}`;
  const response = await fetch(meta_url);
  const json = await response.json()
  const promises = [];
  const fetchedFiles = [];
  for (const f of json.files) {
    if (f.name.startsWith(`/${dir}/`) && /\.mo$/.test(f.name)) {
      const promise = (async () => {
        const content = await (await fetch(base_url + f.name)).text();
        const stripped = name + f.name.slice(dir.length + 1);
        fetchedFiles.push(stripped);
        Motoko.saveFile(stripped, content);
      })();
      promises.push(promise);
    }
  }
  Promise.all(promises).then(() => {
    Motoko.addPackage(name, name + '/');
    console.log("base library loaded");
    changeCodeBlock(); // from run_repl.js
  });
}
function loadBase() {
  addPackage('base', 'dfinity/motoko-base', 'moc-0.6.27', 'src');
}
</script>
<script async src="../../_/js/vendor/moc.js" onload="loadBase()">
</script>
  </body>
</html>
